services:
  database:
    image: mariadb:10.3
    ports:
      - "3306:3306"
    environment:
      - MARIADB_DATABASE=adminchouettos
      - MARIADB_USER=adminchouettos
      - MARIADB_ROOT_PASSWORD=...
      - MARIADB_PASSWORD=...
    volumes:
      - ./data/:/var/lib/mysql
    networks:
      - adminchouettos

  nginx:
    image: nginx:alpine
    ports:
      - "8080:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
      - .:/var/www/html
    depends_on:
      - symfony
    networks:
      - adminchouettos

  symfony:
    build: .
    volumes:
      - .:/var/www/html
    environment:
      - SYMFONY_DATABASE_HOST=database
      - SYMFONY_DATABASE_PORT_NUMBER=3306
      - SYMFONY_DATABASE_NAME=adminchouettos
      - SYMFONY_DATABASE_USER=adminchouettos
      - SYMFONY_DATABASE_PASSWORD=...
      - DATABASE_URL=mysql://adminchouettos:...@database:3306/adminchouettos?serverVersion=mariadb-10.3.23&charset=utf8
    expose:
      - "9000"
    depends_on:
      - database
    networks:
      - adminchouettos

  cron:
    build: ./cron/
    depends_on:
      - symfony
    networks:
      - adminchouettos

networks:
  adminchouettos:
    driver: bridge
